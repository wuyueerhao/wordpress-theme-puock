name: Sync Upstream Code (Main Branch)

on:
  schedule:
    - cron: "0 */6 * * *"  # 每 6 小时自动运行一次（可自定义）
  workflow_dispatch:      # 支持手动触发

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout your fork (wuyueerhao/wordpress-theme-puock)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 获取全部 Git 历史，便于 merge

      - name: Set Git Identity
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Add 'upstream' remote (original repo)
        run: |
          git remote add upstream https://github.com/Licoy/wordpress-theme-puock.git

      - name: Fetch upstream branches and commits
        run: |
          git fetch upstream

      - name: Checkout your main branch
        run: |
          git checkout master  # 如果你用 master，请改成 git checkout master

      - name: Merge upstream/main into your main
        run: |
          git merge upstream/main --allow-unrelated-histories -X theirs || echo "Merge failed or not needed"

      - name: Push changes to your fork's main branch
        run: |
          git push origin master
