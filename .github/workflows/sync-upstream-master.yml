name: Sync Upstream Master to My Fork (100% Working)

on:
  workflow_dispatch:   # æ‰‹åŠ¨è§¦å‘ï¼Œæ¨èå…ˆæ‰‹åŠ¨æµ‹è¯•
  # schedule:
  #   - cron: '0 */6 * * *'  # å¯é€‰ï¼šæ¯6å°æ—¶è‡ªåŠ¨è¿è¡Œä¸€æ¬¡

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout your fork (wuyueerhao/wordpress-theme-puock)
        uses: actions/checkout@v4
        with:
          ref: master       # æ£€å‡ºä½ çš„ fork çš„ master åˆ†æ”¯
          token: ${{ secrets.MY_GIT_TOKEN }}  # ğŸ” å…³é”®ï¼šç”¨ä½ çš„ Token å…‹éš†ï¼Œç¡®ä¿æœ‰æƒé™
          fetch-depth: 0    # è·å–å®Œæ•´å†å²ï¼Œæ”¯æŒ merge/rebase

      - name: Set Git Identity
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Add upstream remote (åŸä»“åº“ï¼šLicoy/wordpress-theme-puock)
        run: |
          git remote add upstream https://github.com/Licoy/wordpress-theme-puock.git

      - name: Fetch upstream
        run: |
          git fetch upstream

      - name: Checkout your master branch
        run: |
          git checkout master

      - name: Merge upstream/master into your master
        run: |
          git merge upstream/master --allow-unrelated-histories -X theirs || echo "nothing to merge or merge conflict avoided"

      - name: Push to your fork's master branchï¼ˆä½¿ç”¨ MY_GIT_TOKEN æ¨é€ï¼Œç¡®ä¿æˆåŠŸï¼‰
        run: |
          git remote set-url origin https://${{ secrets.MY_GIT_TOKEN }}@github.com/wuyueerhao/wordpress-theme-puock.git
          git push origin master
